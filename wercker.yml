box: wercker/android@0.0.17
# Build definition
build:
  # The steps that will be executed on build
  steps:
    - script:
        name: show environment
        code: |
          export
          cd /home/ubuntu/android-sdk-linux
          expect -f $WERCKER_SOURCE_DIR/android-update.exp "tools,platform-tools,android-19,android-18,android-17,sysimg-18,extra-android-support,extra-android-m2repository"

          android list targets
    # - android-sdk-update:
    #     filter: "platform-tools,android-19,android-18,android-17,sysimg-19,extra-android-support,extra-android-m2repository,sys-img18"
    # - setup-android-emulator:

    #     target: android-18
    - script:
        name: setup emulator
        code: |
          export WERCKER_SETUP_ANDROID_EMULATOR_TARGET_NAME=wercker
          export WERCKER_SETUP_ANDROID_EMULATOR_TARGET=android-18
          export WERCKER_SETUP_ANDROID_EMULATOR_ABI=armeabi-v7a
          echo no | android create avd --force -n $WERCKER_SETUP_ANDROID_EMULATOR_TARGET_NAME -t $WERCKER_SETUP_ANDROID_EMULATOR_TARGET --abi $WERCKER_SETUP_ANDROID_EMULATOR_ABI
          emulator -avd $WERCKER_SETUP_ANDROID_EMULATOR_TARGET_NAME -no-skin -no-audio -no-window &
          echo "wait for emulator"
          $WERCKER_STEP_ROOT/wait_for_emulator.sh

    - script:
        name: run gradle connectedInstrumentTest
        code: |
          gradle cIT

